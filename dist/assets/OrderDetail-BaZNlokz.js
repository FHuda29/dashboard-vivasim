import{af as R,y as q,r as p,j as e}from"./index-bBoaL7NX.js";import{P as M}from"./PageContainer-ClH7HaBW.js";import{P as T}from"./ParentCard-CFe-nEgX.js";import{B as U}from"./BlankCard-BfHU7njI.js";import{f as G,n as H,c as f}from"./Utils-DZtz8wsc.js";import{i as d}from"./axios-MmGZYXFl.js";import{j as Q}from"./index-VWaDGczM.js";import{B as W}from"./Box-Cbtftx36.js";import{G as r}from"./Grid2-CC46JW8y.js";import{T as a}from"./Typography-B41TU7cT.js";import{C as J}from"./Chip-Bm7HxxC0.js";import{D as O}from"./Divider-4e_Zm7wz.js";import{B as u}from"./Button-2ihUhOt_.js";import"./Paper-CEo52ZYq.js";import"./Card-DDyARx6g.js";import"./CardHeader-BGxrrKRe.js";import"./useSlot-C2y4Okaq.js";import"./CardContent-TrRQSIz8.js";import"./index-J11PKsb-.js";import"./index-DT2YvziZ.js";import"./apiConstants-C71iLEz3.js";import"./styled-oSX1ZV8o.js";import"./isMuiElement-CYEUdTOG.js";import"./useThemeProps-BUO-Zg8Q.js";import"./dividerClasses-D6e-UzmO.js";import"./useId-BgKtfLA5.js";import"./CircularProgress-BIjyWvHZ.js";const fe=()=>{const{order_id:c}=R(),x=q(),[y,D]=p.useState(""),[S,P]=p.useState(""),[K,A]=p.useState("");p.useEffect(()=>{const s=localStorage.getItem("token");if(s){const t=Q(s);console.log("user_name:",t.user_name),console.log("session_name:",t.session_name),console.log("session_level:",t.session_level),console.log("last_login_time:",t.last_login_time),console.log("blocked:",t.blocked),D(t.user_name),P(t.session_level),A(t.session_name),console.log("order_id: ",c),B(c),t.session_level.toLowerCase()==="partner"||t.session_level.toLowerCase()==="partner-admin"?t.session_name.split("-")[0]:t.session_level.toLowerCase()}else x("/auth/login")},[]);const[L,N]=p.useState([]),j=L,B=async s=>{let t="orders/id/"+s;d.get(t).then(n=>{console.log("order_detail: ",n.data),N(n.data.orders)}).catch(n=>{n.response&&n.response.status===403||n.response.status===401?x("/auth/login"):console.log(n)})},E=async s=>{try{const n=(await d.get("orders/update/"+s+"/Approved")).data;if(n){if(n.order_id===s){let o="",h="",g="",v=0;console.log("order xxx: ",j),j.forEach(i=>{console.log("CCID: ",i.order_ccid),console.log("country_name: ",i.country_name),console.log("package_id: ",i.package_id),o=i.order_ccid,h=i.country_name,g=i.package_id,v=i.total_order});const C=o.includes(","),m={out_date:f(),status:"Used",order_id:s,country_id:h,package_id:g,selling_price:v};if(console.log("updateInvSIM: ",m),C){const i=o.split(",");console.log("length: ",i.length),i.forEach(async I=>{console.log("CCID PARSE: ",I),await _(I,m)})}else console.log("delimiter false"),await _(o,m);const b=f();await z({seq:0,order_id:s,event_name:"Approve Order",event_date:b,username:y}),x("/order/list")}}else console.error("Error update status gagal")}catch(t){console.error("Error adding order events :",t)}},F=async s=>{try{const n=(await d.get("orders/update/"+s+"/Paid")).data;if(n){if(n.order_id===s){const o=f();await z({seq:0,order_id:s,event_name:"Confirm Order",event_date:o,username:y}),x("/order/list")}}else console.error("Error update status gagal")}catch(t){console.error("Error adding order events :",t)}},k=async()=>{try{const t=(await d.get("orders/update/"+c+"/Cancelled")).data;if(t){if(t.order_id===c){let n="",o="",h="",g=0;j.forEach(l=>{n=l.order_ccid,o=l.country_name,h=l.package_id,g=l.total_order});const v=n.includes(","),C={out_date:null,status:"Ready",order_id:null,country_id:null,package_id:null,selling_price:0};if(v){const l=n.split(",");console.log("length: ",l.length),l.forEach(async i=>{console.log("CCID PARSE: ",i),await _(i,C)})}else console.log("delimiter false"),await _(n,C);const m=f();await z({seq:0,order_id:c,event_name:"Cancel Order",event_date:m,username:y}),x("/order/list")}}else console.error("Error update status gagal")}catch(s){console.error("Error adding order events :",s)}},_=async(s,t)=>{try{const o=(await d.put("inventory/ccid/"+s,t)).data;console.log("res updated: ",o)}catch(n){console.error("Error updating inventory sim:",n)}},z=async s=>{try{const n=(await d.post("order/event",s)).data}catch(t){console.error("Error adding order events :",t)}};return e.jsx(M,{title:"Order",description:"this is order detail page",children:e.jsx(T,{title:"Order Detail",children:e.jsx(U,{children:e.jsx(W,{m:2,children:j.map(s=>e.jsx(r,{children:e.jsxs(r,{container:!0,spacing:1,children:[e.jsx(r,{size:{xs:2},children:e.jsx(a,{variant:"h6",children:"Order ID"})}),e.jsx(r,{size:{xs:4},children:e.jsxs(a,{variant:"subtitle1",children:[": ",s.order_id]})}),e.jsx(r,{size:{xs:2},children:e.jsx(a,{variant:"h6",children:"Order Date"})}),e.jsx(r,{size:{xs:4},children:e.jsxs(a,{variant:"subtitle1",children:[": ",G(s.order_date)]})}),e.jsx(r,{size:{xs:2},children:e.jsx(a,{variant:"h6",children:"Status"})}),e.jsx(r,{size:{xs:4},children:e.jsxs(a,{variant:"subtitle1",children:[": ",e.jsx(J,{color:s.order_status==="Paid"?"success":s.order_status==="New"?"warning":s.order_status==="Cancel"?"error":"secondary",sx:{borderRadius:"6px"},size:"small",label:s.order_status})]})}),e.jsx(r,{size:{xs:2},children:e.jsx(a,{variant:"h6",children:"Agent Code"})}),e.jsx(r,{size:{xs:4},children:e.jsxs(a,{variant:"subtitle1",children:[": ",s.agent_code]})}),e.jsx(r,{size:{xs:12},mt:2,mb:2,children:e.jsx(O,{})}),e.jsx(r,{size:{xs:2},children:e.jsx(a,{variant:"h6",children:"Customer Name"})}),e.jsx(r,{size:{xs:4},children:e.jsxs(a,{variant:"subtitle1",children:[": ",s.customer_name]})}),e.jsx(r,{size:{xs:2},children:e.jsx(a,{variant:"h6",children:"Email Address"})}),e.jsx(r,{size:{xs:4},children:e.jsxs(a,{variant:"subtitle1",children:[": ",s.email_address]})}),e.jsx(r,{size:{xs:2},children:e.jsx(a,{variant:"h6",children:"Contact Phone"})}),e.jsx(r,{size:{xs:4},children:e.jsxs(a,{variant:"subtitle1",children:[": ",s.contact_phone]})}),e.jsx(r,{size:{xs:2},children:e.jsx(a,{variant:"h6",children:"Contact Whatsapp"})}),e.jsx(r,{size:{xs:4},children:e.jsxs(a,{variant:"subtitle1",children:[": ",s.contact_wa]})}),e.jsx(r,{size:{xs:12},mt:2,mb:2,children:e.jsx(O,{})}),e.jsx(r,{size:{xs:2},children:e.jsx(a,{variant:"h6",children:"Quantity"})}),e.jsx(r,{size:{xs:10},children:e.jsxs(a,{variant:"subtitle1",children:[": ",s.order_quantity]})}),e.jsx(r,{size:{xs:2},children:e.jsx(a,{variant:"h6",children:"Harga NTA"})}),e.jsx(r,{size:{xs:10},children:e.jsxs(a,{variant:"subtitle1",children:[": ",H(s.total_order)]})}),e.jsx(r,{size:{xs:2},children:e.jsx(a,{variant:"h6",children:"Country List"})}),e.jsx(r,{size:{xs:10},children:e.jsxs(a,{variant:"subtitle1",children:[": ",s.country_name]})}),e.jsx(r,{size:{xs:2},children:e.jsx(a,{variant:"h6",children:"Package ID"})}),e.jsx(r,{size:{xs:10},children:e.jsxs(a,{variant:"subtitle1",children:[": ",s.package_id]})}),e.jsx(r,{size:{xs:2},children:e.jsx(a,{variant:"h6",children:"Package Name"})}),e.jsx(r,{size:{xs:10},children:e.jsxs(a,{variant:"subtitle1",children:[": ",s.package_name]})}),e.jsx(r,{size:{xs:2},children:e.jsx(a,{variant:"h6",children:"ICCID List"})}),e.jsx(r,{size:{xs:10},style:{wordBreak:"break-all"},children:e.jsxs(a,{variant:"subtitle1",children:[": ",s.order_ccid.replace("|",",")]})}),e.jsx(r,{size:{xs:12},mt:2,mb:2,children:S.toLowerCase()==="agent-manager"?e.jsxs(e.Fragment,{children:[s.order_status==="Approved"?e.jsx(u,{variant:"contained",color:"primary",onClick:()=>F(s.order_id),children:"Confirm Order"}):s.order_status==="Paid"||s.order_status==="Cancelled"||s.order_status==="Closed"?e.jsx(e.Fragment,{}):e.jsx(u,{variant:"contained",color:"primary",onClick:()=>E(s.order_id),children:"Approve Order"}),s.order_status==="Paid"||s.order_status==="Cancelled"||s.order_status==="Closed"?e.jsx(e.Fragment,{}):e.jsxs(e.Fragment,{children:["   ",e.jsx(u,{variant:"contained",color:"secondary",onClick:k,children:"Cancel"})]})]}):s.order_status==="New"?e.jsxs(e.Fragment,{children:[e.jsx(u,{variant:"contained",color:"primary",onClick:()=>E(s.order_id),children:"Approve Order"}),"   ",e.jsx(u,{variant:"contained",color:"secondary",onClick:k,children:"Cancel"})]}):e.jsx(e.Fragment,{})})]})},s.order_id))})})})})};export{fe as default};
